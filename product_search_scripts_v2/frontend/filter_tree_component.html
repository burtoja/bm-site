
<div x-data="filterTree()" x-init="init()" class="p-4 space-y-3 max-w-3xl text-white">

    <!-- Loop through categories -->
    <template x-for="category in categories" :key="category.name">
        <div class="bg-gray-800 rounded p-3">
            <button type="button" @click="category.open = !category.open" class="w-full text-left font-bold">
                <span x-text="category.open ? '− ' + category.name : '+ ' + category.name"></span>
            </button>

            <div x-show="category.open" class="ml-4 mt-2 space-y-2">

                <!-- Global Filters (Collapsible Toggles) -->
                <div class="bg-gray-900 p-3 rounded space-y-2" x-data="{
                    conditionOpen: false,
                    priceOpen: false,
                    sortOpen: false
                  }">

                    <!-- Condition -->
                    <div>
                        <button type="button" @click="conditionOpen = !conditionOpen" class="text-sm underline">
                            <span x-text="conditionOpen ? '− Condition' : '+ Condition'"></span>
                        </button>
                        <div x-show="conditionOpen" class="ml-4 mt-1">
                            <select x-model="$parent.globalFilters.condition" class="text-black w-full rounded px-2 py-1 mt-1">
                                <option value="">Any</option>
                                <option value="New">New</option>
                                <option value="Used">Used</option>
                            </select>
                        </div>
                    </div>

                    <!-- Price Range -->
                    <div>
                        <button type="button" @click="priceOpen = !priceOpen" class="text-sm underline">
                            <span x-text="priceOpen ? '− Price Range' : '+ Price Range'"></span>
                        </button>
                        <div x-show="priceOpen" class="ml-4 mt-1 space-y-2">
                            <select x-model="$parent.globalFilters.priceRange" class="text-black w-full rounded px-2 py-1">
                                <option value="any">Any</option>
                                <option value="under100">Under $100</option>
                                <option value="custom">Custom</option>
                            </select>
                            <div x-show="$parent.globalFilters.priceRange === 'custom'" class="flex space-x-2">
                                <input type="number" placeholder="Min $" x-model="$parent.globalFilters.minPrice" class="text-black px-2 py-1 rounded w-1/2" />
                                <input type="number" placeholder="Max $" x-model="$parent.globalFilters.maxPrice" class="text-black px-2 py-1 rounded w-1/2" />
                            </div>
                        </div>
                    </div>

                    <!-- Sort Order -->
                    <div>
                        <button type="button" @click="sortOpen = !sortOpen" class="text-sm underline">
                            <span x-text="sortOpen ? '− Sort Order' : '+ Sort Order'"></span>
                        </button>
                        <div x-show="sortOpen" class="ml-4 mt-1">
                            <select x-model="$parent.globalFilters.sortOrder" class="text-black w-full rounded px-2 py-1 mt-1">
                                <option value="high_to_low">High to Low</option>
                                <option value="low_to_high">Low to High</option>
                            </select>
                        </div>
                    </div>
                </div>


                <!-- Category-level filters -->
                <template x-if="category.filters.length > 0">
                    <div>
                        <template x-for="filter in category.filters" :key="filter.name">
                            <div>
                                <button type="button" @click="filter.open = !filter.open" class="text-sm underline">
                                    <span x-text="filter.open ? '− ' + filter.name : '+ ' + filter.name"></span>
                                </button>
                                <div x-show="filter.open" class="ml-4 mt-1 space-y-1">
                                    <template x-for="option in filter.options" :key="option.id">
                                        <label class="block">
                                            <input type="checkbox" :value="option.id" x-model="selectedOptions" class="mr-1">
                                            <span x-text="option.value"></span>
                                        </label>
                                    </template>
                                </div>
                            </div>
                        </template>
                    </div>
                </template>

                <!-- Subcategories -->
                <template x-for="subcat in category.subcategories" :key="subcat.name">
                    <div class="bg-gray-700 p-3 rounded ml-4">
                        <button type="button" @click="subcat.open = !subcat.open" class="w-full text-left font-semibold">
                            <span x-text="subcat.open ? '− ' + subcat.name : '+ ' + subcat.name"></span>
                        </button>

                        <div x-show="subcat.open" class="ml-4 mt-2 space-y-2">
                            <template x-if="subcat.filters.length > 0">
                                <template x-for="filter in subcat.filters" :key="filter.name">
                                    <div>
                                        <button type="button" @click="filter.open = !filter.open" class="text-sm underline">
                                            <span x-text="filter.open ? '− ' + filter.name : '+ ' + filter.name"></span>
                                        </button>
                                        <div x-show="filter.open" class="ml-4 mt-1 space-y-1">
                                            <template x-for="option in filter.options" :key="option.id">
                                                <label class="block">
                                                    <input type="checkbox" :value="option.id" x-model="selectedOptions" class="mr-1">
                                                    <span x-text="option.value"></span>
                                                </label>
                                            </template>
                                        </div>
                                    </div>
                                </template>
                            </template>

                            <template x-for="subsub in subcat.subcategories" :key="subsub.name">
                                <div class="bg-gray-600 p-3 rounded ml-4">
                                    <button type="button" @click="subsub.open = !subsub.open" class="w-full text-left font-medium">
                                        <span x-text="subsub.open ? '− ' + subsub.name : '+ ' + subsub.name"></span>
                                    </button>

                                    <div x-show="subsub.open" class="ml-4 mt-2 space-y-2">
                                        <template x-if="subsub.filters.length > 0">
                                            <template x-for="filter in subsub.filters" :key="filter.name">
                                                <div>
                                                    <button type="button" @click="filter.open = !filter.open" class="text-sm underline">
                                                        <span x-text="filter.open ? '− ' + filter.name : '+ ' + filter.name"></span>
                                                    </button>
                                                    <div x-show="filter.open" class="ml-4 mt-1 space-y-1">
                                                        <template x-for="option in filter.options" :key="option.id">
                                                            <label class="block">
                                                                <input type="checkbox" :value="option.id" x-model="selectedOptions" class="mr-1">
                                                                <span x-text="option.value"></span>
                                                            </label>
                                                        </template>
                                                    </div>
                                                </div>
                                            </template>
                                        </template>
                                    </div>
                                </div>
                            </template>

                        </div>
                    </div>
                </template>
            </div>
        </div>
    </template>

    <!-- Submit button -->
    <div class="mt-4">
        <button @click="submitFilters()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded text-white">
            Search
        </button>
    </div>
</div>
